from robot.robots.elfin.elfin_connection import (
    ElfinConnection,
    Axis,
    Direction,
    MotionState,
    ReferenceFrame
)

ip = "192.168.200.251"
connection = ElfinConnection(
    ip=ip,
    use_new_api=True,
)
connection.connect()

#

from robot.robots.elfin.elfin import (
    Elfin,
)

ip = "192.168.200.251"
connection = Elfin(
    ip=ip,
    use_new_api=True,
)
connection.connect()
connection.initialize()

import numpy as np
target = np.array([-319.624, 417.909, 609.683, 164.699, -48.66, 150.725])

connection.move_linear(target - 20)
connection.move_linear(target)

connection.tune_robot([10, 0, 0, 0, 0, 0])



## testing without the coil

# moving to [0, 0, 0, 1493, 0, 0, 0], after "axis has been violated" error:
>>> connection.get_coordinates()
(True, [-0.043, -0.01, 1492.949, 0.002, -0.01, 0.003])

# re-moving to the same coordinates, after "singularity error":
>>> connection.get_coordinates()
(True, [-0.018, -0.033, 1493.0, 0.004, -0.002, -0.001])

# after moving using "homing" button in UI:
>>> connection.get_coordinates()
(True, [0.005, -0.0, 1493.0, -0.0, 0.0, -0.001])










#target = (359.13165772375675,712.5796911086164,540.6382536017243,-175.352,-51.228,113.194)
#target = (376.8736040408137,693.1432950905702,583.1535324628039,-175.352,-51.228,113.194)

NEWEST POSITION (THU EVENING):
[299.515, 99.756, 1148.94, 102.546, 41.955, 19.122]

NEWEST POSITION (FRI MORNING):
[232.118, 757.472, 521.554, -171.354, -53.004, 93.489]

orig: [17.203469663269715, -12.243863030244484, -19.05942577287333, 19.979656768516985, -0.24660442626468412, -0.8199062116184794]
rz_offset:  180
transformed: [-17.203469663269715, -12.243863030244485, -19.05942577287333, -19.97965676851699, -0.24660442626468657, -0.8199062116184791]

UUSI TARGETTI PE-AAMU:

estimated target in robot space:
[232.13737858806547, 757.9862595053188, 521.3167355100305, -171.06049552599504, -53.16582139939044, 93.3817681170239]
robot pose:
[ 232.115  757.472  521.553 -171.353  -53.004   93.488]

MYÖHEMMIN:
[232.12, 757.472, 521.554, -133.418, -30.051, 39.623]


SAMA TARGETTI LA-AAMU:
[231.942, 757.246, 519.659, -133.493, -29.891, 39.669]




displacement orig:
[-1.7675386361316043, -0.6933341795239585, -1.1871784843543907, 0.056895668380619185, -0.12552099489228696, -0.6175073470502253]
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: [1.7675386361316043, 0.6933341795239587, -66.18717848435439, 0.05689566838061917, -0.12552099489228696, 179.38249265294976]


estimated target in robot space:
[244.20635299860012, 704.5425587809726, 557.8298645199145, -172.23238193991773, -52.78906676729533, 94.63713413958592]
robot pose:
[231.942 757.246 519.658 171.202  52.857 -86.624]


UUSI TARGETTI LA-ILTAPÄIVÄ:

[240.137, 751.267, 483.177, -168.294, 51.375, -63.329]


displacement orig:
[-0.11944868446160228, -0.07854660641061173, 0.21233351441336623, -0.0593148309304829, -0.051660466945454946, -0.02277817638814961]
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: [0.1780288295396092, 0.011232783154882006, 0.21227226219835416, 0.0593148309304829, 0.05166046694545495, -0.022778176388149614]



X +10:

displacement orig:
[-19.477071763879835, -0.8382794382249585, -0.21258669943700426, -0.043592913993946984, -0.015091323780438303, -0.14573210171468862]
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: [19.494066479241223, 0.78878146460532, -0.21260776766921197, 0.043592913993947, 0.015091323780438308, -0.14573210171468862]
estimated target in robot space:
[250.49653912341316, 728.8343328177142, 452.3545653901591, -168.07585135008995, 51.329442264978056, -63.10452026443351]
robot pose:
[ 245.746  740.108  467.554 -168.294   51.374  -63.328]


robot pose:
[ 245.746  740.109  467.553 -168.295   51.374  -63.33 ]
estimated target in robot space:
[241.18691513599632, 751.2500715706111, 482.7963596393261, -168.49271927862623, 51.52175762511048, -63.40440712134784]


Z +10:

displacement orig:
(1.1180981155876992, 0.6557842775227982, -19.006844072413138, 0.17209228257215098, 0.07893689217446578, 0.04872128175812664)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: [-1.2078147295338746, -0.460628289107175, -19.00719895746373, -0.17209228257215098, -0.0789368921744658, 0.04872128175812665]
estimated target in robot space:
[240.30899177372893, 751.7536750498369, 482.87892713507364, -168.51194202533173, 51.53716583401452, -63.39396656024301]
robot pose:
[ 237.125  765.682  470.277 -168.3     51.45   -63.343]


RX +10:

displacement orig:
(0.05443401485379695, -3.3603517544914325, -0.6642953341691964, 9.809037087918146, 0.10916884567705296, -0.18234570801808705)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: [-0.14122849946809424, 14.434404019422375, -1.614644022464006, -9.809037087918146, -0.10916884567705415, -0.18234570801808697]
estimated target in robot space:
[226.4016650767726, 748.2033476187432, 480.63728078635296, -168.05701831707634, 51.57130351214255, -63.056674316304964]
robot pose:
[ 240.306  751.755  482.881 -158.512   51.537  -63.394]

tähän mennessä:
        displacement = -displacement[0], displacement[1], displacement[2], displacement[3], -displacement[4], -displacement[5]


RZ_OFFSET = 0:


UUSI TARGETTI:

target robot pose:
[190.052 699.043 533.367 167.73   46.698 -91.622]



displacement orig:
(-0.48582314622873923, 1.257111224048579, 0.12823349301996245, 0.20369450071458414, 0.12252185939607288, -0.3752827282241228)
tcp offset:
[30.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: (-0.48582314622873923, 1.257111224048579, 0.12823349301996245, 0.20369450071458414, 0.12252185939607288, -0.3752827282241228)
estimated target in robot space:
[188.80336530191533, 699.3084131330938, 533.81784792036, 168.35038496226392, 46.65660361198949, -91.04978422946344]
robot pose:
[190.052 699.043 533.367 167.73   46.698 -91.622]


displacement orig:
(20.031550825866645, -0.4761104549086639, 0.375250801221199, 0.2226016287551353, 0.08650856250363322, 0.4960280873656646)
tcp offset:
[30.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: (20.031550825866645, -0.4761104549086639, 0.375250801221199, 0.2226016287551353, 0.08650856250363322, 0.4960280873656646)
estimated target in robot space:
[189.6713925462827, 671.928693171627, 503.91694433182755, 167.45893040774948, 46.50703878015873, -92.30251993322305]
robot pose:
[189.666 685.332 518.816 167.729  46.699 -91.625]




UUSI TARGET SU:

oikea: [189.507, 685.125, 517.241, 167.643, 46.564, -91.674]

X +20:
displacement orig:
(-20.252408229190706, -0.5611101827491609, 0.21734210606888382, -0.16469355015372825, -0.1315954202352441, 0.20324734727777977)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: (-20.252408229190706, -0.5611101827491609, 0.21734210606888382, -0.16469355015372825, -0.1315954202352441, 0.20324734727777977)

estimated target in robot space:
[188.26011574961143, 684.8810948634008, 517.3991168759599, 168.03619110488074, 46.64008519902519, -91.16802232750136]
robot pose:
[189.112 671.378 502.722 167.642  46.565 -91.674]

Y +20:
displacement orig:
(0.569837345576147, -17.534761498160165, 0.13151525080454007, 0.031186509741943248, 0.003573403577617158, -0.248997395464731)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: (0.569837345576147, -17.534761498160165, 0.13151525080454007, 0.031186509741943248, 0.003573403577617158, -0.248997395464731)

estimated target in robot space:
[188.6458215714395, 685.626661292312, 517.0416927140653, 167.45077054298775, 46.64839485628257, -91.80548582971595]
robot pose:
[169.895 682.587 520.188 167.642  46.565 -91.674]

Z +20:
displacement orig:
(0.45048956243257976, -0.9419192310488427, -20.420883230047593, 0.010550878186996024, -0.014006073859845992, -0.04049223688946273)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: (0.45048956243257976, -0.9419192310488427, -20.420883230047593, 0.010550878186996024, -0.014006073859845992, -0.04049223688946273)

estimated target in robot space:
[190.227701443849, 684.8313947336193, 517.1189466594336, 167.68973927970868, 46.59622188850326, -91.61568859807497]
robot pose:
[185.647 699.433 503.815 167.641  46.565 -91.675]

RX +10:
displacement orig:
(-0.7968055239217193, 3.801376883598863, -0.14765207056936447, -9.742428842754233, -0.14717531267009407, -0.1752036699150479)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: (-0.7968055239217193, 3.801376883598863, -0.14765207056936447, -9.742428842754233, -0.14717531267009407, -0.1752036699150479)
estimated target in robot space:
[185.12309914799914, 664.9458330633584, 496.24756418406685, 168.07857646728812, 46.71899513721834, -91.42849272864343]
robot pose:
[188.904 664.508 495.46  177.642  46.565 -91.675]


RX +20:
displacement orig:
(-1.028502686938367, 6.41543448087306, 0.9980649206754322, -20.00795509900635, -0.5572931183199933, -0.4907095125855321)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: (-1.028502686938367, 6.41543448087306, 0.9980649206754322, -20.00795509900635, -0.5572931183199933, -0.4907095125855321)
estimated target in robot space:
[182.7467053694472, 666.7320594763313, 494.94018325716485, 168.23134008605183, 47.049167162449336, -90.85246542459386]
robot pose:
[188.91, 664.506, 495.46, -172.358, 46.565, -91.675]


oikea: [189.507, 685.125, 517.241, 167.643, 46.564, -91.674]

estimated target in robot space:
[182.4040931598092, 687.7236407070868, 516.6114283265982, 167.63616571806503, 47.19219910887021, -91.55504656206402]
robot pose:
[ 189.513  685.124  517.245 -172.358   46.565  -91.674]

RZ +20:
estimated target in robot space:
[198.73199628265695, 683.926909290853, 511.80351431255036, 167.99254951944928, 46.97413612029279, -90.83780188886415]
robot pose:
[ 189.511  685.124  517.245  150.072   39.2   -117.213]

displacement orig:
(0.6002094052143576, -10.092902109742887, 1.1241121354290726, -0.16234720024135074, -0.2710850479309304, -20.49458833171706)
tcp offset:
[30.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: (0.6002094052143576, -10.092902109742887, 1.1241121354290726, -0.16234720024135074, -0.2710850479309304, -20.49458833171706)


UUSI TAAS KUN EI PYSY:

oikea targetti:
[189.51  685.124 517.242 167.643  46.564 -91.674]

RX +10:
displacement orig:
(-0.7797766066858998, 4.654585870468047, 0.49356090230185146, -10.027719443885271, -0.35504907399382757, 0.534612266713389)
displacement stored: (-0.7797766066858998, 4.654585870468047, 0.49356090230185146, -10.027719443885271, -0.35504907399382757, 0.534612266713389)

robot pose:
[189.509 685.124 517.242 177.643  46.564 -91.675]
estimated target in robot space:
[185.21068013309323, 685.6249031183278, 517.4368157595028, 167.02358978649906, 46.932679407507486, -92.42773670581752]

RX +20:

displacement orig:
(-0.8923763789775023, 7.567475419908213, 1.3049560587356837, -20.007562861639563, -0.6326646879792459, -0.01742961034602301)

robot pose:
[ 189.504  685.125  517.241 -172.357   46.564  -91.674]
estimated target in robot space:
[182.57062699257173, 687.110723714374, 516.6520344171843, 168.13145534662388, 47.03407853094458, -91.16222664104978]

RY +10:
displacement orig:
(-3.8003802148508896, 0.4273491180450364, 1.3581246595278458, -0.019201775132725467, -10.246074678639028, 0.25395506596993844)
estimated target in robot space:
[188.77331995322047, 688.9095496960795, 518.5088519092191, 167.35338133934357, 46.750613108187906, -92.10684978481892]

RY +20:
robot pose:
[189.51  685.124 517.242 170.502  26.914 -86.965]
estimated target in robot space:
[187.9608975080371, 691.6138154434852, 519.2981944913023, 167.9964928473685, 46.45764745110935, -92.23987995452288]

TARGETTI:

robot pose:
[189.511 685.123 517.241 167.644  46.564 -91.674]


RZ +10:
displacement orig:
(-1.2914735656204641, 0.7008406992909855, 0.6317496260167275, -0.07967536613237095, -0.14965882008772455, -10.037738039972776)
estimated target in robot space:
[188.95785948809595, 686.4735121530704, 517.8961633234179, 167.56915886535478, 46.71774895725307, -91.66560652397152]
robot pose:
[ 189.509  685.123  517.24   158.027   43.595 -105.218]

RZ +20:
displacement orig:
(-0.025685673215235738, 0.7489920409383544, -1.097172463933731, 0.4653042501667957, 0.04349043851315222, -20.060372598083962)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: (-0.025685673215235738, 0.7489920409383544, -1.097172463933731, 0.4653042501667957, 0.04349043851315222, -20.060372598083962)
estimated target in robot space:
[189.04380780745748, 684.4427488259007, 518.2826985160299, 168.1798778993734, 46.53359300622971, -91.57431818956603]
robot pose:
[ 189.508  685.123  517.24   150.073   39.199 -117.212]


RZ 0:
estimated target in robot space:
[188.35494859326224, 685.5538206025094, 517.7879327106658, 167.23864884944845, 46.40496828713196, -92.34286193301881]
robot pose:
[189.509 685.125 517.242 167.643  46.564 -91.673]

RZ +10:
displacement stored: (-1.2186474593883645, 0.7926534152006113, 0.7812749631044369, 0.004959391191128418, -0.1267517628579359, -10.164957644376729)
estimated target in robot space:
[188.82471656265577, 686.5280377758756, 517.7704137241939, 167.78963977179146, 46.72260238437128, -91.47623457096928]
robot pose:
[ 189.507  685.122  517.24   158.026   43.595 -105.217]

RZ +10 RX +10:
displacement stored: (-2.935113163529877, 4.571755334339905, 0.781979973309717, -9.907909070773071, -0.29566977636402014, -10.001624473366086)
estimated target in robot space:
[185.5617574503942, 688.2675745213738, 519.3978416686242, 167.79994728469913, 45.13893331370373, -91.37072047396835]
robot pose:
[ 189.509  685.122  517.241  168.026   43.595 -105.218]

RZ +10 RX +10 RY +10:
displacement stored: (-6.362724191307336, 3.8795260345038614, 1.270075631071478, -9.846499286853357, -10.14274157477596, -11.700772633920614)
estimated target in robot space:
[186.7961240194166, 691.4700905271454, 520.3246643102805, 167.3567701028912, 45.22962360411875, -89.22570212275639]
robot pose:
[ 189.509  685.123  517.242  169.585   33.783 -102.734]


RZ +10 RX +10 RY +10 X +10:
displacement orig:
(-14.646127410116208, 1.0815688184518208, 2.0769816564232144, -9.951572666833451, -10.179460178940353, -11.698495524480965)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 180.0]
displacement stored: (-14.646127410116208, 1.0815688184518208, 2.0769816564232144, -9.951572666833451, -10.179460178940353, -11.698495524480965)
estimated target in robot space:
[189.1848521388883, 690.207841675105, 518.289632982315, 167.24803190708295, 45.26618898086726, -89.23142834973932]
robot pose:
[ 187.679  677.015  511.681  169.585   33.783 -102.734]


estimated target in robot space:
[191.65413891576725, 695.2829178968329, 517.0680796947547, 167.8194885135396, 45.29545827573426, -88.26472001524346]

estimated target in robot space:
[191.77124004767822, 695.968273226066, 517.190625633126, 167.7300706253322, 45.30573046632525, -88.2797287954774]



UUTTA, 0 deg:

[206.71176888485957, 674.7914880285025, 504.10880947369344, -173.07889215819603, -36.27454078212541, 79.38294911700379]
[205.86481794554192, 674.7926596719886, 504.6929455123587, -172.57236616798312, -35.984559470117226, 78.76548056825285]

X +10:

displacement orig:
(-9.234712300568077, -0.3024227651461331, 0.3272513534569157, 0.051096412803000715, -0.046541300504761914, 0.23416572745556974)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 0.0]
displacement stored: (-9.234712300568077, -0.3024227651461331, 0.3272513534569157, 0.051096412803000715, -0.046541300504761914, 0.23416572745556974)
estimated target in robot space:
[207.13006367790905, 675.4858782628719, 508.87997344768473, -169.3856822981397, -33.69460675411825, 76.99930232297308]
robot pose:
[ 209.137  682.749  514.237 -169.585  -33.783   77.266]

X +20:

displacement stored: (-19.24747876168469, -0.5727510498106199, 0.18806974105240215, 0.17507590109560636, -0.050016884918024876, 0.3195316288259901)
estimated target in robot space:
[206.87010225342357, 675.4267733359266, 509.02777660681335, -169.20612619561354, -33.6755003733635, 76.89922671587593]
robot pose:
[ 210.969  690.855  519.798 -169.585  -33.783   77.266]


Y +20:
displacement stored: (0.8931456850817341, -19.851998450880984, 0.6823894413251423, -0.28066109028577824, -0.16770343860508347, 0.027944108015348492)
estimated target in robot space:
[207.576946176094, 675.7394691778078, 508.5943352957986, -169.86850574386483, -33.613007883488955, 77.27039851285426]
robot pose:
[ 226.936  672.267  505.673 -169.586  -33.783   77.267]

Z +20:
displacement orig:
(-0.1809293328182946, 0.42251402677189276, -19.973675373778164, -0.06702077306535563, -0.053705209519885486, -0.03790740144405425)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 0.0]
displacement stored: (-0.1809293328182946, 0.42251402677189276, -19.973675373778164, -0.06702077306535563, -0.053705209519885486, -0.03790740144405425)
estimated target in robot space:
[207.68672758138155, 674.4595579921389, 508.48850380144023, -169.68344070276584, -33.737019514783434, 77.32250762006267]
robot pose:
[ 206.191  686.107  492.325 -169.585  -33.783   77.266]

RX +10:
displacement orig:
(-0.4658218615083456, 3.978975204649771, 0.3583996275732204, -9.968123794517027, -0.23903430853095795, -0.04893439344378575)
displacement stored: (-0.4658218615083456, 3.978975204649771, 0.3583996275732204, -9.968123794517027, -0.23903430853095795, -0.04893439344378575)
estimated target in robot space:
[210.94734000382442, 674.4048888305795, 506.98322423211425, -169.6392479040384, -33.57595120516853, 77.42112112520229]
robot pose:
[ 207.306  674.642  508.675 -159.585  -33.783   77.266]

RY +10:

displacement orig:
(-3.8406484632880336, 0.5380147560160111, 0.3568026678374281, 0.19835000606885267, -9.960016126228517, -0.12401501379996654)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 0.0]
displacement stored: (-3.8406484632880336, 0.5380147560160111, 0.3568026678374281, 0.19835000606885267, -9.960016126228517, -0.12401501379996654)
estimated target in robot space:
[207.09967685909396, 672.1448072966472, 505.69703172314803, -169.4835741069991, -33.844734777004426, 77.40223734143504]
robot pose:
[ 207.31   674.641  508.679 -168.026  -43.595   74.782]

RZ +10:
displacement orig:
(-1.7427005613941589, -1.3492858534400085, -1.9449290423754917, -0.5879359052652001, -0.21805337297707914, -9.517731518924567)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 0.0]
displacement stored: (-1.7427005613941589, -1.3492858534400085, -1.9449290423754917, -0.5879359052652001, -0.21805337297707914, -9.517731518924567)
estimated target in robot space:
[205.54085195126277, 672.520259404236, 509.6869800028113, -169.882890010938, -33.48070217084852, 76.74604836187935]
robot pose:
[ 207.305  674.643  508.676 -163.346  -31.434   65.721]

RZ +10 RX +10 RY +10 X +10:
displacement orig:
(-13.078935998972995, 1.178842961236768, 3.2187969485822236, -9.939671177695722, -9.732184021218833, -12.50305416075293)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 0.0]
displacement stored: (-13.078935998972995, 1.178842961236768, 3.2187969485822236, -9.939671177695722, -9.732184021218833, -12.50305416075293)
estimated target in robot space:
[206.71176888485957, 674.7914880285025, 504.10880947369344, -173.07889215819603, -36.27454078212541, 79.38294911700379]
[205.54540858657626, 674.4146872918346, 504.8889943261319, -172.8742557568856, -35.95933346076098, 78.8805568073576]
[205.86481794554192, 674.7926596719886, 504.6929455123587, -172.57236616798312, -35.984559470117226, 78.76548056825285]
robot pose:
[ 211.143  681.241  515.135 -149.904  -40.242   59.863]



SAMA TARGETTI MA-AAMUNA:

SU-ILLAN POSE: [231.296, 698.269, 529.42, -158.153, -44.642, 72.053]
MA-AAMUN POSE: [231.134, 698.037, 527.751, -158.115, -44.491, 72.033]


displacement orig:
(-3.11663967794982, 1.95226479463509, 1.6730871684722786, -11.33860723119741, -8.147260897416743, -11.663334822216461)
tcp offset:
[0.0, 0.0, 65.0, 0.0, 0.0, 0.0]
displacement stored: (-3.11663967794982, 1.95226479463509, 1.6730871684722786, -11.33860723119741, -8.147260897416743, -11.663334822216461)
estimated target in robot space:
[209.41268493617034, 680.9383261333759, 511.4960634349684, -140.04063336832598, -30.87457949227132, 39.71712520146449]
robot pose:
[ 211.142  681.241  515.135 -120.641  -25.885   24.594]


+X 10:
displacement orig:
(0.3856210087081138, 2.7291457842685345, 1.1719028490341827, -9.884489338838812, -0.2446988707517946, 0.4192308128280952)

+X 10 +Y 10:
displacement orig:
(-2.3546604482251894, 2.9728575718101515, 1.9282278708871843, -9.566044093656236, -10.004183999709067, -1.4846514324211526)

+X 10 +Y 10 +Z 10:
displacement orig:
(-3.4583803682445478, 1.0688785439118718, 1.5656992235627172, -11.46871592856688, -8.113420835025579, -11.284259556968438)

+X 10 +Y 10 +Z 20:
displacement orig:
(-4.062742201147188, 1.1890249582066446, 1.690849456402674, -12.436261428038824, -5.835391706504468, -21.143584199671118)

+X 10 +Y 10 +Z 30:
displacement orig:
(-4.392332356550014, 0.9600610217339351, 0.99075366401118, -13.579585160839905, -3.575303121815431, -31.198704340888572)

NEW TARGET:

asmot:
[290.41284910810805, 774.1200568847538, 455.7108777408092, 160.27688061053155, -47.428579685057336, 123.44177167661076]
[290.526 774.296 455.531 160.277 -47.457 123.506]




uusi target:
[211.143, 681.242, 515.136, -138.678, -28.434, 40.199]

liikutetaan:
[261.143, 731.242, 565.136, -108.678, -8.434, 20.199]

displacement stored: (-90.20530752812644, 14.72221853338741, 7.053189147268768, -23.17523798780097, 0.316236862950353, -27.41968712470541)
estimated target: [178.73310008271184, 703.0171620229218, 535.9864579273124, -135.46925272891488, -33.98423998402312, 29.91047705487329]


x+20:
[209.92629935815484, 681.8918925042447, 515.7445593682783, -138.55925555602386, -28.009308730499065, 39.61401533050991]

Y+20:
displacement stored: (0.38587708914903374, -19.848719635237458, -0.29228767280170587, -0.1501467346853615, -0.03811608907982319, 0.2712235915943912)
[211.55428393478573, 681.190263076893, 515.4207657744936, -138.7319081729497, -28.225138123469375, 39.99638451660652]

Z+20:
displacement stored: (-0.00945482642390516, -0.14981070777709826, -20.084176484106877, -0.16030744685214673, -0.0031009241057201415, 0.3341720540229599)
estimated target in robot space:
[211.0439398776771, 681.2305004345228, 515.2783423837591, -138.7042840624034, -28.210729205760323, 39.9165276588178]

RX+10:
displacement stored: (0.24614581175410422, 2.9092203884527454, 1.034510697594385, -9.958212817386297, -0.22438481133661625, 0.2670683891685737)
estimated target in robot space:
[213.0196427659324, 681.506562172493, 512.6845164636931, -138.6401278083324, -28.08528013901289, 40.20837323536498]

RY+10:
displacement orig:
(-2.5287860661703405, -0.32268966532420773, 1.1490173693803172, 0.417679281808066, -9.894626743180796, 0.11283175072947862)
estimated target in robot space:
[208.6261342587216, 681.2366314234275, 513.3744812033167, -138.25936512042756, -28.4443879672861, 39.989187329328715]

RZ+10:
displacement stored: (-0.7277062932359968, -1.7698859194642798, 0.1493565752960535, -0.1486592826531305, 0.09257601330649226, -9.484347952251499)
estimated target in robot space:
[209.49416628627154, 681.8124645080062, 515.9288781241992, -138.58626077498698, -28.16245485451874, 39.69028937330778]

BEFORE HOMING:

target = [290.808, 774.646, 457.429, 160.029, -47.531, 123.678]
connection.move_linear(target)

AFTER HOMING:

[0.001, 0.0, 1493.0, 0.0, 0.0, 0.0]

MOVED TO:

[290.811, 774.644, 457.425, 160.029, -47.531, 123.678], created a new target

NEXT MORNING:

distance to target: 1.70-2.30 mm

location: [290.584, 774.378, 455.834, 160.233, -47.471, 123.532]

after enabling: [290.56, 774.37, 455.819, 160.248, -47.473, 123.519]

moving to previous days target: ([290.811, 774.644, 457.425, 160.029, -47.531, 123.678])

distance to target: 0.50-0.70 mm



asmot vielä huonompi:
[379.27921313615497, 745.1231962446235, 431.98665526888755, 173.1221461168309, -31.0281325421728, 124.21923661832211]
[229.763 601.905 350.381 175.091 -29.298  82.204

asmot ei hyvä:
[313.38087685991707, 744.720080886999, 434.59590862255686, 162.4612485301858, -43.22074997541485, 122.48079517487089]
[ 242.508  699.979  461.388 -156.667  -42.952   69.903]

asmot korjauksen jälkeen:
[289.5550783877816, 772.7351521875463, 458.6621602538463, 160.37841907855392, -47.69518616929954, 122.26078126256353]
[259.402 708.752 519.93  179.786 -47.602 109.193]

asmot targetissa:
target: [291.19083204226223, 774.0339007937497, 457.89587882730837, 160.19226836191544, -47.44648946901304, 123.159290221115]
pose: [290.815 774.643 457.429 160.029 -47.531 123.678]

liikuttamisen jälkeen:
target: [276.03683369766503, 779.2068925435169, 459.5860934089981, 160.08025741897671, -51.94716152070979, 124.77123431545547]
pose: [259.539 708.927 521.823 179.599 -47.714 109.318]

157.5 deg:
asmot:
target: [276.0972981266071, 779.3911991504727, 459.52873383305564, 160.074381261395, -51.997804326501935, 124.95693174526953]
pose: [259.541 708.926 521.827 179.599 -47.714 109.317]

22.5 deg:
asmot:
target: [276.9004259395903, 778.543854887827, 458.8191222568317, 159.63860726325302, -51.736656342021774, 125.2711398686107]
pose: [259.541 708.926 521.827 179.599 -47.714 109.318]

displacement orig: [20.756071421929505, 33.18850208422151, 87.11548405325067, 9.439261632682332, 1.6278108723386413, -9.243440744654016]
rz_offset:  22.5
displacement stored: [-6.475419669417286, 38.60518244447937, 87.11548405325067, -8.114163233445206, 5.104930192090883, -9.471360922553208]

157.5 deg:

asmot:
target: [210.19917181499972, 782.8991297130642, 486.6631318299055, 178.7513271721401, -48.893741381672214, 123.1725449334281]
pose: [259.541 708.926 521.827 179.599 -47.714 109.318]

displacement orig: [20.480618964171065, 32.89197104069521, 86.93067526911227, 9.550073348058246, 1.5190755366635478, -9.234021977465057]
rz_offset:  157.5
displacement stored: [31.508837049266536, -22.550625266281738, 86.93067526911227, 9.409852399201137, 2.233764860061624, -8.923255362616763]


-22.5 deg:

asmot:
target: [267.1784392676975, 756.9940148251876, 440.11962333177064, 161.04140880927378, -44.706184824320694, 121.73622983151347]
pose: [259.541 708.926 521.827 179.599 -47.714 109.317]

displacement orig: [20.607547359771836, 32.89082764334668, 86.82443422537548, 9.543333466243492, 1.5088130207457313, -9.125218137210068]
rz_offset:  -22.5
displacement stored: [-31.625666036834694, 22.50099551078081, 86.82443422537548, -9.39973027905843, -2.2407227585370646, -8.815024732379792]


-157.5 deg:

asmot:
target: [201.08578327622092, 761.4913015131452, 467.56129194742005, 178.4546006238985, -41.808128110964276, 121.77449288414726]
pose: [259.541 708.926 521.827 179.599 -47.714 109.317]

displacement orig: [20.456513373158295, 33.07708965753653, 87.24865360703723, 9.396480157424774, 1.6331586718028368, -9.100796765811452]
rz_offset:  -157.5
displacement stored: [6.2412998092104734, -38.38761488150135, 87.24865360703723, 8.072397619159721, -5.093670270660248, -9.32622200889569]








start_position = [344.56483403511737, 711.8179106863369, 520.2739102191287, -172.459, -49.541, 106.712]
connection.move_linear(start_position)

radius = 200

# Extract the x and y coordinates of the start position
x_start, y_start = start_position[0], start_position[1]

# Calculate the center of the circle (assuming start position is at 0 degrees on the circle)
center_x = x_start - radius
center_y = y_start

import math

# Calculate the waypoint at a 45-degree angle on the circle
angle_rad = math.radians(45)  # Convert 45 degrees to radians for calculation
waypoint_x = center_x + radius * math.cos(angle_rad)
waypoint_y = center_y + radius * math.sin(angle_rad)

# The z coordinate and orientation angles for the waypoint remain the same as the start position
waypoint = [waypoint_x, waypoint_y] + start_position[2:]

# Calculate the end position at a 90-degree angle on the circle
end_x = center_x  # x coordinate is the same as the center's x at 90 degrees
end_y = center_y + radius  # y coordinate is center's y plus the radius

# The z coordinate and orientation angles for the end position remain the same as the start position
end_position = [end_x, end_y] + start_position[2:]

#waypoint = (386.42269353446096, 758.8221304658806, 460.4541215490738, -168.71693632949257, -53.627653419575225, 96.77674332808424)
#target = (398.1721681145139, 836.2114639445782, 337.5746381076145, -168.71693632949257, -53.627653419575225, 96.77674332808424)
start_position = [314.542, 743.252, 597.112, -175.287, -43.117, 128.864]
waypoint = [395.723, 771.624, 609.915, -179.525, -52.314, 104.125]
end_position = [499.824, 718.381, 694.772, -177.37, -59.311, 87.836]

# Same angles:
#start_position = [314.542, 743.252, 597.112, -175.287, -43.117, 128.864]
#waypoint = [395.723, 771.624, 609.915, -175.287, -43.117, 128.864]
#end_position = [499.824, 718.381, 694.772, -175.287, -43.117, 128.864]


connection.move_circular(start_position, waypoint, end_position)

connection.move_linear(start_position)

connection.get_motion_state()

#new:

#coil:
#[ 1.83972000e+02  4.22652000e+01 -1.49508000e+03 -2.16496363e+01
#  5.98516296e-01 -1.42646544e+01]
#robot:
#[ 314.543  743.252  597.108 -175.286  -43.117  128.863]

#old:
#Tracker:
#[ 1.84114000e+02  4.25118000e+01 -1.49506000e+03 -1.42542711e+01
#  5.65428751e-01 -2.15461843e+01]
#robot:
#[ 314.542  743.252  597.108  128.863  -43.117 -175.286]

#Update target based on InVesalius: [370.87627441773714, 766.5047802026843, 404.8785364402171, 167.91920126587056, -48.932487701124046, 126.78778204321425]
#Target set
#initializing filter
#simot:
#(344.56483403511737, 711.8179106863369, 520.2739102191287, -172.459, -49.541, 106.712)
#(386.42269353446096, 758.8221304658806, 460.4541215490738, -168.71693632949257, -53.627653419575225, 96.77674332808424)
#(398.1721681145139, 836.2114639445782, 337.5746381076145, -168.71693632949257, -53.627653419575225, 96.77674332808424)

#ismot (toimii?):
#(421.5813239808815, 676.0283983847683, 534.678306722179, -151.412, -58.382, 99.6)
#(427.27047508190356, 712.7973047727254, 505.2220023887801, 168.7987205385438, -45.123717546927914, 129.1536750852586)
#(405.4191394140928, 774.1554815559617, 439.30951063108836, 168.7987205385438, -45.123717546927914, 129.1536750852586)

#ismot (uusi robottikalibraatio):
#(276.128435227031, 575.0283252126317, 496.911245897694, -169.107, -48.162, 88.605)
#(356.48198770885585, 637.1309970645041, 525.3844758300431, 173.02267514500596, -37.111305836360515, 128.6173318608815)
#(427.2107042724115, 752.7574841331639, 514.3885151547694, 173.02267514500596, -37.111305836360515, 128.6173318608815)

target = (421.5813239808815, 676.0283983847683, 534.678306722179, -151.412, -58.382, 99.6)

target = (427.27047508190356, 712.7973047727254, 505.2220023887801, 168.7987205385438, -45.123717546927914, 129.1536750852586)
target = (344.56483403511737, 711.8179106863369, 520.2739102191287, -172.459, -49.541, 106.712)
target = (405.4191394140928, 774.1554815559617, 439.30951063108836, 168.7987205385438, -45.123717546927914, 129.1536750852586)

target = (276.128435227031, 575.0283252126317, 496.911245897694, -169.107, -48.162, 88.605)
target = (356.48198770885585, 637.1309970645041, 525.3844758300431, 173.02267514500596, -37.111305836360515, 128.6173318608815)
target = (427.2107042724115, 752.7574841331639, 514.3885151547694, 173.02267514500596, -37.111305836360515, 128.6173318608815)
connection.move_linear(target)

järjestys:
distance to target
angular distance to target
head center
linear out target
waypoint
arc motion target

simot:
149.0183747117476
357.3803166134126
[309.83628894734204, 823.0543020538169, 419.97718436622836]
(286.87705730471384, 591.9646682387178, 546.8666332263946, -179.024, -42.329, 128.774)
(326.08760271737924, 632.4538908759663, 554.9928412366402, 174.88509296314362, -43.54464237660585, 123.3407174570258)
(368.204589947733, 720.3076299395178, 535.5592029143542, 174.88509296314362, -43.54464237660585, 123.3407174570258)

simot uusi:
148.27991938826193
12.481059531077797
[309.8851469380779, 822.7106404284518, 420.192928953918]
(286.85756917648513, 591.9634967569865, 546.8609649581628, -179.024, -42.329, 128.775)
(325.8792467604064, 632.3605813748775, 555.3213853200746, 174.82521155109208, -43.3581287653215, 123.29426226126142)
(367.80309679557274, 720.0924888007943, 536.2025108116238, 174.82521155109208, -43.3581287653215, 123.29426226126142)

simot vanha:
148.39528249336442
357.85920738624776
[310.57304697359643, 822.8697232026495, 420.1748412220694]
(286.701415003669, 591.9688795670681, 546.8418657771713, -179.024, -42.329, 128.775)
(325.95260555871397, 632.4380322100375, 555.3640593485144, 174.55096450841108, -43.329929941604675, 123.64194547392829)
(368.2836096488844, 720.2754962193343, 536.3088697725746, 174.55096450841108, -43.329929941604675, 123.64194547392829)

asmot vanha:
tuning to target: [272.47304752955677, 766.5387817771718, 454.9774713420878, 178.43090142173074, -45.002633017115905, 123.16182436089562]
current robot: [ 291.215  635.627  522.892  128.775  -42.329 -179.024]

asmot uusi:
target in robot space: [273.3232675955173, 766.9673611010084, 454.80329712533864, 178.3058324369348, -45.081728546294755, 123.43508261484077]
robot_pose: [ 291.215  635.627  522.892 -179.024  -42.329  128.774]

(array([[-1.53057656e-01, -7.35027297e-01,  6.60536318e-01,
        -2.44601239e+00],
       [ 2.80871613e-01, -6.73202518e-01, -6.84039112e-01,
        -5.31158268e+00],
       [ 9.47462132e-01,  8.08284779e-02,  3.09487101e-01,
         9.03681189e+01],
       [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
         1.00000000e+00]]), array([[-3.27561578e-01, -4.72885337e-01, -8.17974860e-01,
        -8.78738605e+02],
       [ 3.63774717e-01, -8.62118937e-01,  3.52730625e-01,
         1.27613958e+03],
       [-8.71992757e-01, -1.82017573e-01,  4.54420769e-01,
         1.37911399e+03],
       [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
         1.00000000e+00]]), array([[-2.79353359e-01, -5.36243405e-01, -7.96495268e-01,
        -8.10315594e+02],
       [ 4.49908638e-01, -8.05924472e-01,  3.84796001e-01,
         1.24347524e+03],
       [-8.48259346e-01, -2.50856046e-01,  4.66398248e-01,
         1.44898308e+03],
       [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
         1.00000000e+00]]))


coili:
[  228.816        -21.5211     -1638.44         -22.62371001
    10.94177135   -22.19939487]
robo:
[427.208 752.759 514.39  173.023 -37.111 128.617]



Rank deficient
[-5.68434189e-14 -2.27373675e-13 -5.68434189e-13]
[5.68434189e-14 0.00000000e+00 1.13686838e-13]
[[2.3437142e-13]
 [0.0000000e+00]]

X_est:
[[-4.68284260e-02  2.16901885e-01 -9.75069572e-01  4.68960593e+02]
 [-4.13844172e-01 -8.92638151e-01 -1.78690046e-01 -6.90490647e+02]
 [-9.09142508e-01  3.95159086e-01  1.31564421e-01 -1.43288008e+02]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]

Y_est:
[[-2.31928217e-01 -7.28307091e-01  6.44808564e-01  7.60541530e+02]
 [-9.25864433e-01 -3.79996470e-02 -3.75940260e-01  1.73919121e+02]
 [ 2.98302455e-01 -6.84196469e-01 -6.65500441e-01 -3.29486789e+02]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]

affine_matrix_robot_to_tracker:
[[ 1.000000e+00  0.000000e+00  0.000000e+00 -1.983920e+02]
 [ 0.000000e+00  1.000000e+00  0.000000e+00 -7.742801e+02]
 [ 0.000000e+00  0.000000e+00  1.000000e+00 -2.152830e+03]
 [ 0.000000e+00  0.000000e+00  0.000000e+00  1.000000e+00]]

X_est:
[[-3.93247199e-01 -2.23690587e-02  9.19160631e-01 -7.88350695e+02]
 [-3.75130767e-01  9.16614138e-01 -1.38186215e-01 -1.88035022e+02]
 [-8.39424534e-01 -3.99146775e-01 -3.68847265e-01 -2.10449932e+02]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]

Y_est:
[[ 2.76075200e-01  2.27818694e-01 -9.33745751e-01 -5.80472951e+02]
 [-8.86388454e-01  4.35972508e-01 -1.55703179e-01  3.54925576e+02]
 [ 3.71615382e-01  8.70647239e-01  3.22297058e-01  4.88080066e+02]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]

affine_matrix_robot_to_tracker:
[[ 1.000000e+00  0.000000e+00  0.000000e+00 -1.983920e+02]
 [ 0.000000e+00  1.000000e+00  0.000000e+00 -7.742801e+02]
 [ 0.000000e+00  0.000000e+00  1.000000e+00 -2.152830e+03]
 [ 0.000000e+00  0.000000e+00  0.000000e+00  1.000000e+00]]


ylempi träkeri, alempi robotti
 täsä yks:
tracker_poses = [
  [228.412, -22.61, -1638.73, -22.36740004, 11.07427461, -22.32237471],
  [225.153, 105.925, -1600.31, 6.43127147, 6.17923781, -19.26227308],
  [223.994, 198.591, -1224.55, 13.47359985, 10.47174428, -18.59978936],
  [69.8059, -25.7234, -1491.81, -28.65991835, 16.59224509, 25.29047199],
  [226.997, 74.1213, -1754.86, 8.37268341, 15.34425658, 40.58079336],
]
robot_poses = [
  [431.444, 756.415, 515.618, 126.746, -37.781, 172.275],
  [379.398, 706.685, 517.558, 122.991, -30.659, -163.245],
  [10.93, 755.763, 662.615, 124.432, -21.086, -153.844],
  [352.066, 718.848, 701.632, 63.201, -47.587, -157.351],
  [485.104, 645.922, 453.446, 65.103, -12.494, -152.075],
]


vanhalla:
[[-1.18116282e-01 -7.37453179e-01  6.64989739e-01  7.01567119e+00]
 [ 2.53959972e-01 -6.69840317e-01 -6.97723643e-01 -8.92210593e+00]
 [ 9.59975456e-01  8.64682530e-02  2.66402636e-01  8.75682588e+01]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]
[[-3.25884392e-01 -4.93803928e-01 -8.06199134e-01 -8.53846424e+02]
 [ 4.04961157e-01 -8.43469819e-01  3.52937850e-01  1.27666754e+03]
 [-8.54286734e-01 -2.11462398e-01  4.74845059e-01  1.42035382e+03]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]
[[-2.14304996e-01  5.83185081e-01 -7.83561440e-01  2.94758235e+02]
 [-5.78338418e-01 -7.22226738e-01 -3.79358952e-01  9.91886407e+02]
 [-7.87145503e-01  3.71865164e-01  4.92055135e-01 -1.82796885e+03]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]

uudella:
[[ 4.74845059e-01 -2.11462398e-01 -8.54286734e-01  2.59271561e+02]
 [ 3.52937850e-01 -8.43469819e-01  4.04961157e-01 -4.15555940e+02]
 [-8.06199134e-01 -4.93803928e-01 -3.25884392e-01  1.20528990e+02]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]
[[ 2.66402636e-01  8.64682530e-02  9.59975456e-01  1.36158316e+03]
 [-6.97723643e-01 -6.69840317e-01  2.53959972e-01  1.19623481e+03]
 [ 6.64989739e-01 -7.37453179e-01 -1.18116282e-01  3.44699448e+01]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]
[[-2.14304996e-01  5.83185081e-01 -7.83561440e-01  2.94758235e+02]
 [-5.78338418e-01 -7.22226738e-01 -3.79358952e-01  9.91886407e+02]
 [-7.87145503e-01  3.71865164e-01  4.92055135e-01 -1.82796885e+03]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]

vanhalla:

alkuperäinen: [431.444, 756.415, 515.618, 126.746, -37.781, 172.275]
remapped: [451.9820634314432, 764.375633808351, 529.96059486024, 127.68265778445007, -37.725245297590604, 170.41790273456337]

uudella:

alkuperäinen: 
remapped: [451.9820634314432, 764.375633808351, 529.96059486024, 170.41790273456337, -37.725245297590604, 127.68265778445007]

uudella, trackeria ei käännetä:
[451.9820634314432, 764.375633808351, 529.96059486024, 171.2498780720965, -39.65014001784669, 127.61737142704722]




Target:
[[0.9186171818535364, 0.3335975579793529, 0.21179032677079157, 264.341706574416],
 [-0.37826720094021976, 0.8973825643102458, 0.22719695852897867, 61.131280492387475],
 [-0.11426459598807452, -0.2888203638633871, 0.9505400567685207, -1579.5082273997643],
 [0.0, 0.0, 0.0, 1.0]]

Update target based on InVesalius:
[349.23519616153874, 746.8716250397674, 499.17983518487813, 174.28946294265572, -33.78093012104507, 128.95530689623786]

Update target based on InVesalius:
[349.24424071794385, 746.9733405786183, 499.3763628143696, 174.19128377964836, -33.82041384501156, 128.99553261461867]

Update target based on InVesalius:
[349.0918671289388, 747.008863467313, 499.2819821405484, 170.3793711132065, -34.19688908095988, 123.64509385334834]






OIKEA:

targetti:
coil:
[  263.726         60.4597     -1579.42         -22.43749609
     6.63979867   -17.23856554]
robot:
[336.031 717.349 485.952 177.743 -43.184 123.522]



NEW, VERY CLOSE TO TARGET:

target in robot space:
[335.91333192489066, 717.2339701881871, 485.29038956911563, 178.0937589186171, -43.33318253693377, 123.24702476781209]


NEW, FURTHER FROM TARGET:

true coordinates:  [388.437, 641.394, 536.483, -172.032, -41.465, 126.255]

RADIANS NOT FIXED:

target in robot space:
[317.25032221844947, 705.4944301893537, 486.87384303954445, 179.80114080912466, -46.968901160580444, 122.27577439231855]

displacement orig: [-36.253420501373434, 10.077856760078106, 101.01155335508088, 12.29044916081159, 0.9999465095735429, 2.452633040237667]
displacement stored: [37.20989631911515, -5.5943999541288045, 101.01155335508088, -10.846611808867257, 5.8998104827618505, 1.9996889257395483]


import robot.control.robot_processing as robot_process
robot_pose = [388.437, 641.394, 536.483, -172.032, -41.465, 126.255]
displacement = [-36.253420501373434, 10.077856760078106, 101.01155335508088, 12.29044916081159, 0.9999465095735429, 2.452633040237667]
displacement = [-36.253420501373434, 10.077856760078106, 101.01155335508088, 2.452633040237667, 0.9999465095735429, 12.29044916081159]

displacement = [37.20989631911515, -5.5943999541288045, 101.01155335508088, -10.846611808867257, 5.8998104827618505, 1.9996889257395483]
m_robot = robot_process.coordinates_to_transformation_matrix(robot_pose[:3], robot_pose[3:], axes='sxyz')
m_offset = robot_process.coordinates_to_transformation_matrix(displacement[:3], displacement[3:], axes='sxyz')
m_final = m_robot @ m_offset
translation, angles_as_deg = robot_process.transformation_matrix_to_coordinates(m_final, axes='sxyz')



RADIANS FIXED:

target in robot space:
[333.30716625268036, 653.3227268735191, 444.081399958396, -157.25593832019916, -44.55426828719173, 121.68453477887354]

displacement orig: [-36.374399054865385, 11.329983878394017, 101.3100275356096, 12.258520210754343, 1.1033471510486843, 1.9472189788826875]
displacement stored: [-29.26976567496306, -24.38742008946445, 101.3100275356096, 11.765360516328895, 3.637708189674051, 2.440640173811429]

asmo:  [317.01586747600766, 706.0170414514516, 486.62850849281256, 179.82659496437287, -47.090500609798745, 122.47358947705855]

    def OnCoilToRobotAlignment(self, displacement):
        xaxis, yaxis, zaxis = [1, 0, 0], [0, 1, 0], [0, 0, 1]

        rx_offset = self.site_config['rx_offset']
        ry_offset = self.site_config['ry_offset']
        rz_offset = self.site_config['rz_offset']

        Rx = tr.rotation_matrix(np.radians(rx_offset), xaxis)
        Ry = tr.rotation_matrix(np.radians(ry_offset), yaxis)
        Rz = tr.rotation_matrix(np.radians(rz_offset), zaxis)

        rotation_alignment_matrix = tr.multiply_matrices(Rx, Ry, Rz)

        fix_axis = -displacement[0], displacement[1], displacement[2], -displacement[3], displacement[4], displacement[5]
        m_offset = robot_process.coordinates_to_transformation_matrix(
            position=fix_axis[:3],
            orientation=fix_axis[3:],
            axes='sxyz',
        )
        displacement_matrix = np.linalg.inv(rotation_alignment_matrix) @ m_offset @ rotation_alignment_matrix

        return robot_process.transformation_matrix_to_coordinates(displacement_matrix, axes='sxyz')



NEW, ORIGINAL:

Update target based on InVesalius:
[348.9099051667846, 746.9485012750988, 499.0387111858628, 175.25305139615412, -43.601889829809174, 122.5958787495863]

Head:
[269.33315465328394, 844.2827815860526, 542.1016084991536, -150.38378141751454, 52.273064970117396, -66.04608976423789]

NEW, FIXED:

Update target based on InVesalius:
[349.58788338920306, 747.2764056191186, 499.3017470229562, 174.86746115999478, -43.57000291674484, 123.12620079273644]

Head:
[269.3757939347048, 844.2479319240956, 542.0742186699939, -150.94882967773339, 52.28937914498022, -66.77960278044048]


NEW:

testpoint:
[451.9820634314432, 764.375633808351, 529.96059486024, 170.41790273456337, -37.725245297590604, 127.68265778445007]

Update target based on InVesalius:
[349.41304726285273, 746.9636023902023, 499.8362988920369, 176.38355665650752, -39.27435420775681, 128.67218516599831]

Head:
[269.3918210846988, 844.1949703688144, 542.0789137871664, -151.054737386137, 52.15399959046428, -67.04706918041805]


OLD:

testpoint:
[451.9820634314432, 764.375633808351, 529.96059486024, 127.68265778445007, -37.725245297590604, 170.41790273456337]

Update target based on InVesalius:
[349.037326531702, 747.0608973819549, 498.7736692484983, 122.6187908255656, -43.735431025413774, 175.32699440158632]

Head coordinates:
[269.26751383097474, 844.2249675119117, 542.2028779677894, -67.1430378318481, 52.24837191707293, -151.18603579489124]


NEW:

[264.62448436813224, 61.00115701626321, -1579.5740120443054, -22.388870441829507, 6.435744185851877, -16.903681852554243]
asko: [451.9820634314432, 764.375633808351, 529.96059486024, 170.41790273456337, -37.725245297590604, 127.68265778445007]
osmo: [349.41304726285273, 746.9636023902023, 499.8362988920369, 176.38355665650752, -39.27435420775681, 128.67218516599831]
osmo 2: [349.41304726285273, 746.9636023902023, 499.8362988920369, 174.77856080648468, -43.360168072290726, 123.09268311410841]
Update target based on InVesalius: [349.3016329599892, 747.1060524663317, 498.9752552430431, 176.75836545809122, -39.41583205924615, 128.63237023431293]
Head: [269.3190942829864, 844.2498440619511, 542.1243310758815, -150.369776607133, 52.122092400893656, -66.16424584922943]

OLD:
asko: [451.9820634314432, 764.375633808351, 529.96059486024, 127.68265778445007, -37.725245297590604, 170.41790273456337]
osmo: [349.41304726285273, 746.9636023902023, 499.8362988920369, 123.09268311410841, -43.360168072290726, 174.77856080648468]
osmo 2: [349.41304726285273, 746.9636023902023, 499.8362988920369, 128.67218516599831, -39.27435420775681, 176.38355665650752]
Update target based on InVesalius: [349.134746040908, 747.2936289276549, 498.93576218874045, 122.81634269978852, -43.731269189787156, 175.16991455370223]
Head coordinates:  [269.36387307750044, 844.2390653021586, 542.0415266804715, -67.07577784322523, 52.30183942652377, -151.1738092898286]


NEW:

Update target based on InVesalius: [349.48010781603955, 747.2599696039754, 499.50013411082875, 174.8330290419568, -43.50187190578624, 123.13202632609998]
Head: [269.3041755734549, 844.2965969978427, 542.10577831082, -150.55867292740152, 52.11509629925026, -66.42004298331877]
target to head:
[[-9.82546153e-01  1.74535473e-01  6.43461376e-02  1.20056927e+02]
 [-1.15503567e-01 -8.43573870e-01  5.24444518e-01 -1.90169315e+01]
 [ 1.45814893e-01  5.07858735e-01  8.49009730e-01  5.37049225e+01]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]

OLD:

Update target based on InVesalius: [349.00903795431066, 747.1239654652646, 498.94754216484444, 122.68620809378811, -43.66471700275463, 175.2301667699798]
Head coordinates:  [269.32906548089056, 844.2785258519913, 542.0982832327377, -66.83738745899306, 52.20263071702901, -150.9451153421899]
robot to head:
[[-9.82807442e-01 -1.13880789e-01  1.45329616e-01  1.08048814e+02]
 [ 1.72900864e-01 -8.43783749e-01  5.08069165e-01 -6.40940238e+01]
 [ 6.47674512e-02  5.24461773e-01  8.48967035e-01 -4.32123022e+01]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]






[[ 9.18771104e-01  3.34089932e-01  2.10341569e-01  2.64440440e+02]
 [-3.78286531e-01  8.97442771e-01  2.26926802e-01  6.11706362e+01]
 [-1.12955560e-01 -2.88063171e-01  9.50926207e-01 -1.57940897e+03]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  1.00000000e+00]]
[264.44043950193543, 61.17063615641786, -1579.408974473708, -22.378483040592098, 6.485718912287851, -16.853085073435746]
Update target based on InVesalius:

[349.11314981500084, 746.937689602941, 499.1363798585302, 176.80422811827881, -39.35464523505412, 128.59642760259032]












täsä yks:
[ 2.49897000e+02  5.21755000e+01 -1.58920000e+03 -1.34773962e+00
  9.66639073e+00 -8.25240232e+00]
[ 372.7    731.704  507.001  110.629  -29.369 -161.348]
täsä yks:

täsä yks:
[ 1.97837000e+02  5.51597000e+01 -1.45619000e+03  3.49747927e+00
  1.02298546e+01 -5.40906610e-01]
[ 269.208  766.138  609.974  103.406  -25.071 -156.068]
täsä yks:
[  223.994        198.591      -1224.55          13.47359985
    10.47174428   -18.59978936]
[  10.93   755.763  662.615  124.432  -21.086 -153.844]
täsä yks:
[ 1.04127000e+02 -8.66199000e+01 -1.44994000e+03 -3.50676452e+01
  1.01106401e+01 -1.02550278e+00]
[342.373 803.553 704.393  99.226 -54.814 179.801]
täsä yks:
täsä yks:
[   96.9178       -33.0552     -1503.21          -9.83213792
    14.33012634    38.4517166 ]
[ 347.432  740.523  680.855   60.896  -23.84  -150.129]
täsä yks:
[   88.9842       287.831      -1376.37          40.43451675
    20.62530341     4.9408975 ]
[ 126.125  602.475  705.736  114.481    6.617 -143.117]
täsä yks:
[   64.4616        16.7034     -1355.51         -23.09207363
    10.71039986    21.81215498]
[ 237.247  737.109  762.997   68.731  -45.792 -153.779]
täsä yks:
täsä yks:
[  117.127         -4.7153     -1548.2          -24.96674603
    18.78121388    24.36305438]
[ 360.04   711.673  639.052   68.183  -43.828 -161.052]





>>> connection.move_circular(start_position, waypoint, end_position)
Sending request: MoveC,0,334.56483403511737,711.8179106863369,520.2739102191287,-172.459,-49.541,106.712,319.92017309444475,747.1732497456642,520.2739102191287,-172.459,-49.541,106.712,284.56483403511737,761.8179106863369,520.2739102191287,-172.459,-49.541,106.712,0,0,1,10,10,1,TCP,Base,0
Done.
True
>>> connection.get_motion_state()
<MotionState.IN_MOTION: 1>
>>> connection.get_motion_state()
<MotionState.IN_MOTION: 1>
>>> connection.get_motion_state()
<MotionState.IN_MOTION: 1>
>>> connection.move_circular(start_position, waypoint, end_position)
Sending request: MoveC,0,334.56483403511737,711.8179106863369,520.2739102191287,-172.459,-49.541,106.712,319.92017309444475,747.1732497456642,520.2739102191287,-172.459,-49.541,106.712,284.56483403511737,761.8179106863369,520.2739102191287,-172.459,-49.541,106.712,0,0,1,10,10,1,TCP,Base,0
Done.
The command MoveC returned the error code: 20018
False
>>> connection.get_motion_state()
<MotionState.IN_MOTION: 1>
>>> connection.get_motion_state()
<MotionState.IN_MOTION: 1>




Head is moving too much
Sending request: GrpStop,0
Done.
The command GrpStop returned the error code: 20018
Head is moving too much
Sending request: GrpStop,0
Done.
The command GrpStop returned the error code: 20018
Head is moving too much
Sending request: GrpStop,0
Done.
The command GrpStop returned the error code: 20018
C:\Users\mTMS\Robot_TMS\robot\control\robot_processing.py:81: RuntimeWarning: invalid value encountered in true_divide
  velocity = (coord_final - coord_init)/(timestamp[-1] - timestamp[0])
C:\Users\mTMS\Robot_TMS\robot\control\robot_processing.py:81: RuntimeWarning: divide by zero encountered in true_divide
  velocity = (coord_final - coord_init)/(timestamp[-1] - timestamp[0])
C:\Python38\lib\site-packages\numpy\core\_methods.py:212: RuntimeWarning: invalid value encountered in reduce
  arrmean = umr_sum(arr, axis, dtype, keepdims=True, where=where)
Disconnected
Traceback (most recent call last):
  File "main_loop.py", line 131, in <module>
    buf = remote_control.get_buffer()
  File "C:\Python38\lib\site-packages\engineio\client.py", line 36, in signal_handler
    return original_signal_handler(sig, frame)
  File "C:\Python38\lib\site-packages\socketio\client.py", line 26, in signal_handler
    return original_signal_handler(sig, frame)
KeyboardInterrupt
^C











λ python
Python 3.8.3 (tags/v3.8.3:6f8c832, May 13 2020, 22:37:02) [MSC v.1924 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> from robot.robot_api.elfin_linux_api import Elfin
>>> connection = Elfin(None)
>>> connection.connect("192.168.200.251", 10003, 1024, 0)
True
>>> connection.SetToolCoordinateMotion(1)
The message SetToolMotion is returning the error code: 20005
False
